[mysql]

# Configura√ß√£o MySQL otimizada para WordPress em hospedagem Cloud
# Compat√≠vel com MySQL 5.7 e ajustes v√°lidos tamb√©m para MySQL 8.0
# Autor: Rarysson Pereira
# Data: 2025-05-21

[mysqld]

# Armazena cada tabela InnoDB em um arquivo separado (melhora backups e uso de disco)
innodb_file_per_table = ON

# Permite envio de pacotes maiores (evita erro em uploads grandes no WordPress)
max_allowed_packet = 256M

# Limita o n√∫mero m√°ximo de conex√µes simult√¢neas (ajustado por plano)
# 2GB: 100 | 4GB: 150 | 8GB: 200 | 16GB: 300
max_connections = 150

# Tempo limite (em segundos) para conex√µes inativas vindas da aplica√ß√£o (ex: WordPress)
# Ap√≥s esse tempo, a conex√£o √© encerrada para liberar recursos
wait_timeout = 60

# Tempo limite para conex√µes interativas, como sess√µes em linha de comando (mysql CLI)
# Pode ser mantido igual ao wait_timeout em servidores de produ√ß√£o
interactive_timeout = 60

# Cache de Consultas (Query Cache)
# OBS: Depreciado no MySQL 8.0 ‚Äì usar Redis ou ProxySQL como alternativa
# Beneficia MySQL 5.7 em sites WordPress com alto volume de leitura

# Par√¢metros:
# query_cache_type  ‚Üí Ativa (1) ou desativa (0) o cache de consultas
# query_cache_limit ‚Üí Tamanho m√°ximo de uma consulta armazen√°vel no cache
# query_cache_size  ‚Üí Tamanho total alocado para o cache de consultas

# Cloud 2GB:
# PHP + MySQL juntos:
#query_cache_type  = 0
#query_cache_limit = 0M
#query_cache_size  = 0M
# Apenas MySQL:
#query_cache_type  = 1
#query_cache_limit = 64M
#query_cache_size  = 256M

# Cloud 4GB:
# PHP + MySQL juntos:
query_cache_type  = 1
query_cache_limit = 64M
query_cache_size  = 256M
# Apenas MySQL:
#query_cache_type  = 1
#query_cache_limit = 128M
#query_cache_size  = 512M

# Cloud 8GB:
# PHP + MySQL juntos:
#query_cache_type  = 1
#query_cache_limit = 128M
#query_cache_size  = 512M
# Apenas MySQL:
#query_cache_type  = 1
#query_cache_limit = 256M
#query_cache_size  = 1024M

# Cloud 16GB:
# PHP + MySQL juntos:
#query_cache_type  = 1
#query_cache_limit = 256M
#query_cache_size  = 1024M
# Apenas MySQL:
#query_cache_type  = 1
#query_cache_limit = 512M
#query_cache_size  = 2048M

# Buffers e tabelas tempor√°rias na mem√≥ria
# Esses par√¢metros ajudam a evitar grava√ß√µes em disco durante opera√ß√µes como JOINs e ORDER BY,
# melhorando a performance em sites WordPress e aplica√ß√µes com consultas complexas.

# Tamanho m√°ximo de uma tabela tempor√°ria criada automaticamente em mem√≥ria (ap√≥s isso, vai para o disco)
tmp_table_size = 128M

# Limite de mem√≥ria para tabelas HEAP (tipo especial de tabela em mem√≥ria, usada internamente pelo MySQL)
max_heap_table_size = 128M

# Mem√≥ria alocada por conex√£o para armazenar dados durante opera√ß√µes de JOIN sem √≠ndice
join_buffer_size = 128M

# Mem√≥ria usada por conex√£o para opera√ß√µes de ordena√ß√£o (ex: ORDER BY)
sort_buffer_size = 128M

# Perfis recomendados:
# PHP + MySQL:
#   2GB:  64M
#   4GB: 128M  ‚Üê em uso
#   8GB: 256M
#   16GB: 512M
# Apenas MySQL:
#   2GB:  128M
#   4GB:  256M
#   8GB:  512M
#   16GB: 1024M

# Buffer para √≠ndices de tabelas MyISAM (n√£o afeta InnoDB)
# Mesmo que o InnoDB seja o padr√£o atual, esse par√¢metro √© mantido por compatibilidade com sistemas legados,
# ou plugins WordPress que ainda usam tabelas MyISAM (ex: estat√≠sticas, logs, caches antigos).

# Par√¢metro ativo: otimizado para Cloud 4GB ‚Äì PHP + MySQL
key_buffer_size = 32M

# Perfis recomendados:
# PHP + MySQL:
#   2GB:  16M
#   4GB:  32M  ‚Üê em uso
#   8GB:  64M
#   16GB: 128M
# Apenas MySQL:
#   2GB:  32M
#   4GB:  64M
#   8GB:  128M
#   16GB: 256M

# Buffer usado para leitura aleat√≥ria de dados ap√≥s opera√ß√µes de ordena√ß√£o (ex: ORDER BY sem √≠ndice)
# Otimiza a leitura sequencial em tabelas grandes ap√≥s ordena√ß√µes.
read_rnd_buffer_size = 64M

# Perfis recomendados:
# PHP + MySQL:
#   2GB:  32M
#   4GB:  64M  ‚Üê em uso
#   8GB:  128M
#   16GB: 256M
# Apenas MySQL:
#   2GB:  64M
#   4GB:  128M
#   8GB:  256M
#   16GB: 512M

# Quantidade m√°xima de tabelas que o MySQL pode manter abertas ao mesmo tempo
# Evita overhead com reabertura constante em sites WordPress com muitos plugins e tabelas
table_open_cache = 1024

# Buffer principal do InnoDB ‚Äì armazena dados e √≠ndices em mem√≥ria
# Recomendado usar entre 60% e 70% da RAM total dispon√≠vel
innodb_buffer_pool_size = 2G

# Perfis recomendados:
# PHP + MySQL:
#   2GB:  512M
#   4GB:  2G   ‚Üê em uso
#   8GB:  4G
#   16GB: 8G
# Apenas MySQL:
#   2GB:  1G
#   4GB:  3G
#   8GB:  6G
#   16GB: 12G

# üîÑ Divide o buffer pool do InnoDB em inst√¢ncias menores, aumentando o paralelismo em servidores com mais RAM
# Ideal para workloads com m√∫ltiplas conex√µes simult√¢neas em leitura (como WordPress com picos de acesso)
# üìå F√≥rmula pr√°tica: 1 inst√¢ncia para cada ~1GB do innodb_buffer_pool_size
# (Evite usar se o buffer pool for menor que 1GB ‚Äî cada inst√¢ncia deve ter pelo menos ~1GB)
innodb_buffer_pool_instances = 2

# Perfis recomendados:
# PHP + MySQL:
#   2GB:  1
#   4GB:  2   ‚Üê em uso
#   8GB:  4
#   16GB: 8
# Apenas MySQL:
#   2GB:  1
#   4GB:  3
#   8GB:  6
#   16GB: 10

# Controla quantas p√°ginas o InnoDB verifica por vez para limpeza de cache (LRU)
# Afeta a efici√™ncia da libera√ß√£o de mem√≥ria quando o buffer pool est√° cheio
innodb_lru_scan_depth = 256

# Define o m√©todo de escrita no disco para evitar cache duplicado (SO + MySQL)
# O_DIRECT economiza RAM e melhora consist√™ncia de escrita
innodb_flush_method = O_DIRECT

# üîß Ajustes avan√ßados de performance ‚Äî use com aten√ß√£o

# Desativa a escrita dupla do InnoDB (aumenta performance, mas reduz seguran√ßa em falhas de energia)
innodb_doublewrite = 0

# Desativa suporte a transa√ß√µes XA distribu√≠das (melhora desempenho se n√£o usado)
innodb_support_xa = 0

# Desativa verifica√ß√£o de integridade das p√°ginas InnoDB (melhora desempenho, mas aumenta risco de corrup√ß√£o silenciosa)
innodb_checksums = 0

# üîÑ Cache de threads reutiliz√°veis para conex√µes
# Reduz o custo de cria√ß√£o e destrui√ß√£o de threads em conex√µes simult√¢neas
# Melhora o desempenho durante picos de tr√°fego com m√∫ltiplos acessos simult√¢neos

# üìå F√≥rmula base recomendada (Releem):
# thread_cache_size = valor-base + (max_connections / 100)
# Obs: o valor-base foi ajustado aqui conforme a RAM do servidor para refletir melhor o uso real em ambientes WordPress

# Divide o buffer pool do InnoDB em inst√¢ncias menores, aumentando o paralelismo em servidores com mais RAM
# Ideal para workloads com m√∫ltiplas conex√µes simult√¢neas em leitura
innodb_buffer_pool_instances = 6

# Perfis recomendados:
#   2GB (max_connections = 100):  4 + (100 / 100) = 5  ‚Üí 5
#   4GB (max_connections = 150):  4 + (150 / 100) = 5.5  ‚Üí 6 ‚Üê em uso
#   8GB (max_connections = 200):  4 + (200 / 100) = 6 ‚Üí 7
#   16GB (max_connections = 300): 4 + (300 / 100) = 7 ‚Üí 8

# ‚öôÔ∏è Define o modo SQL (regras de sintaxe e integridade)
# sql_mode vazio √© mais permissivo ‚Äî √∫til para compatibilidade com aplica√ß√µes legadas como WordPress
sql_mode = ""

# üê¢ Log de queries lentas (ativar para diagnosticar gargalos de performance)
#slow_query_log       = 1
#slow_query_log_file  = /var/log/mysql/slow-queries.log
#long_query_time      = 2

# ‚úÖ Fim das configura√ß√µes personalizadas