[mysql]

# Arquivo de estudo: Configurações comentadas para MySQL
# Perfil: Hospedagem de sites em WordPress, priorizando performance, estabilidade e compatibilidade
# Compatibilidade: MySQL 5.7 e ajustes para MySQL 8.0 onde relevante
# Autor: Rarysson Pereira
# Data: 2025-04-28

[mysqld]

# Ativa criacao de arquivos separados por tabela no InnoDB
# (Importante para recuperar tabelas individualmente e ganhar performance)
# MySQL 5.5+: disponível. Recomendado ativado.
innodb_file_per_table=ON

# Define o tamanho máximo de pacotes de comunicação (uploads de dados grandes, etc)
# MySQL 5.7 / 8.0: recomendado aumentar para sites WordPress que fazem upload de mídias
max_allowed_packet=256M

# Limita o número máximo de conexões simultâneas no MySQL
# Valores recomendados:
#   2GB RAM: 60
#   4GB RAM: 100
#   8GB RAM: 200
#   16GB RAM: 300
max_connections=100

# Define o tempo que uma conexão inativa é mantida antes de ser fechada
wait_timeout=60
interactive_timeout=60

# Cache de consultas (query cache)
# Configuração do Query Cache
# OBS: Depreciado no MySQL 8.0 - usar ProxySQL ou Redis como alternativa.
# Em MySQL 5.7, pode beneficiar sites WordPress focados em leitura.
#
# Configuração para Cloud 2GB:
# - PHP + MySQL no mesmo servidor: Query Cache desabilitado
# - Apenas MySQL: Query Cache ativado
# PHP + MySQL juntos:
query_cache_type=0
query_cache_limit=0M
query_cache_size=0M
# Apenas MySQL:
#query_cache_type=1
#query_cache_limit=64M
#query_cache_size=256M
#
# Configuração para Cloud 4GB:
# - PHP + MySQL juntos:
query_cache_type=1
query_cache_limit=64M
query_cache_size=256M
#
# Configuração para Cloud 8GB:
# - PHP + MySQL juntos:
#query_cache_limit=128M
#query_cache_size=512M
#
# Configuração para Cloud 16GB:
# - PHP + MySQL juntos:
#query_cache_limit=256M
#query_cache_size=1024M


# Tamanho máximo de tabelas temporárias na memória
# Se ultrapassar, gravará no disco (impacto negativo)
# Recomendado:
#   2GB RAM: 64M
#   4GB RAM: 128M
#   8GB RAM: 256M
#   16GB RAM: 512M
tmp_table_size=128M
max_heap_table_size=128M

# Buffers para operações de JOIN (junção de tabelas)
# Recomendado:
#   2GB RAM: 64M
#   4GB RAM: 128M
#   8GB RAM: 256M
#   16GB RAM: 512M
join_buffer_size=128M

# Buffer para operações de ORDER BY (ordenações)
# Recomendado:
#   2GB RAM: 64M
#   4GB RAM: 128M
#   8GB RAM: 256M
#   16GB RAM: 512M
sort_buffer_size=128M

# Buffer usado após operações de ordenação
# Recomendado:
#   2GB RAM: 32M
#   4GB RAM: 64M
#   8GB RAM: 128M
#   16GB RAM: 256M
read_rnd_buffer_size=64M

# Buffer para índices MyISAM
# Recomendado:
#   2GB RAM: 16M
#   4GB RAM: 32M
#   8GB RAM: 64M
#   16GB RAM: 128M
key_buffer_size=32M

# Cache para tabelas abertas
# Recomendado:
#   2GB RAM: 256
#   4GB RAM: 1024
#   8GB RAM: 2048
#   16GB RAM: 4096
table_open_cache=1024

# Ajustes do InnoDB: tamanho do pool de buffer
# Recomendado ocupar 60%-70% da RAM total
#   2GB RAM: 512M
#   4GB RAM: 2G
#   8GB RAM: 4G
#   16GB RAM: 8G
innodb_buffer_pool_size=2G

# Dividir buffer pool em instâncias para paralelismo
#   2GB RAM: 1
#   4GB RAM: 1
#   8GB RAM: 2
#   16GB RAM: 4
innodb_buffer_pool_instances=1

# Otimiza leituras do InnoDB, reduzindo uso de disco
innodb_lru_scan_depth=256

# Força escrita direta em disco
innodb_flush_method=O_DIRECT

# Desabilita escrita dupla do InnoDB
innodb_doublewrite=0

# Configurações de consistência de transações
innodb_support_xa=0
innodb_checksums=0

# Cache de threads para conexões
# Recomendado:
#   2GB RAM: 4
#   4GB RAM: 8
#   8GB RAM: 16
#   16GB RAM: 32
thread_cache_size=8

# Define modo SQL
sql_mode=""

# Logs para diagnosticar queries lentas
# (Descomentar se quiser investigar performance)
#slow_query_log=1
#slow_query_log_file=/var/log/mysql/slow-queries.log
#long_query_time=2

# Fim das configurações personalizadas
